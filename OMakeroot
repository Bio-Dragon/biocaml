open build/Common
open ./etc/OCaml

PROJECT = biocaml
OPAM_PACKAGE_NAME = $(PROJECT)
VERSION = dev

PACKAGES(x) =
  switch $(x)
  case unix
    return core sexplib.syntax comparelib.syntax \
           cfstream future.unix xmlm zip re.perl
  case ez
    return $(PACKAGES unix)
  case async-unix
    return $(PACKAGES unix) async future.async-unix
  case lwt-unix
    return $(PACKAGES unix) lwt lwt.syntax future.lwt-unix
  default
    eprintln(PACKAGES undefined for $(x).)
    exit(1)

LIB_DEPS(x) =
  switch $(x)
  case unix
    return $(EMPTY)
  case ez
    return unix
  case async-unix
    return unix
  case lwt-unix
    return unix
  default
    eprintln(LIB_DEPS undefined for $(x).)
    exit(1)

OCAMLFLAGS = -bin-annot -annot -w A-4-33-41-42-44-45-48 \
             -thread -short-paths -g

MerlinFile()
METAFile()
OpamInstallFile(omake/Solvuu.om)
CleanCommands()

.SUBDIRS: .
  foreach(x => ..., $(LIBS))
    OCamlLibrary($(x))
